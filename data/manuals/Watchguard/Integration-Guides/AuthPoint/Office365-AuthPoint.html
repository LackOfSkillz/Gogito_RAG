<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_Help_Center_Side_Nav" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-toc-path="Self-Help Tools|Integration Guides|AuthPoint" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="Expires" content="3600" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="120x120" href="../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../Skins/Favicons/favicon-16x16.png" /><title>Microsoft 365 Integration with AuthPoint</title>
        <!-- Google Tag Manager -->
        <!-- End Google Tag Manager -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../Skins/Fluid/Stylesheets/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/help_(en-US).css" rel="stylesheet" type="text/css" />
        <link rel="apple-touch-icon" sizes="120x120" href="../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script>/* <![CDATA[ */
			(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-T3SCZC3');/* ]]> */</script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-left" role="navigation" id="offCanvas" data-off-canvas="" data-position="left" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 979px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../en-US/_intro/home.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div id="cover">
                                    </div>
                                    <!-- Google Tag Manager (noscript) -->
                                    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T3SCZC3" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                    </noscript>
                                    <!-- End Google Tag Manager (noscript) -->
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="6" data-mc-toc="True"><span class="MCBreadcrumbsPrefix"> </span>
                                        </div>
                                    </div>
                                    <div role="main" id="mc-main-content">
                                        <h1 id="Microsoft365IntegrationwithAuthPoint" data-magellan-target="Microsoft365IntegrationwithAuthPoint"><a name="aanchor2297"></a>
                                            <MadCap:concept term="Self-Help Tools" /><a name="aanchor2298"></a>
                                            <MadCap:concept term="AuthPoint" />Microsoft 365 Integration with AuthPoint</h1>
                                        <p>This document describes how to set up multi-factor authentication (MFA) for Microsoft 365 with AuthPoint as an identity provider. Microsoft 365 must already be configured and deployed before you set up MFA with AuthPoint.</p>
                                        <p>After you configure MFA for Microsoft 365, we recommend that new AuthPoint users navigate to the IdP portal to activate their token.</p>
                                        <p class="Note">Due to a Microsoft limitation, Microsoft 365 supports AuthPoint MFA for Microsoft Entra ID users only if they are synced with an on-premise AD server. When you import users to AuthPoint, you must sync the users from an on-prem AD. Microsoft 365 does not support MFA for users that only exist in Microsoft Entra ID (formerly Azure AD). For more information, go to <a href="https://techsearch.watchguard.com/KB/WGKnowledgeBase?lang=en_US&amp;SFDCID=kA10H000000g6BaSAI&amp;type=Article" target="_blank">Can Azure AD AuthPoint Users Use Office 365</a> and <a href="https://techsearch.watchguard.com/KB?type=Article&amp;SFDCID=kA16S000000gD9mSAE&amp;lang=en_US" target="_blank">FAQ for AuthPoint and Microsoft Azure Active Directory</a>.</p>
                                        <p>For information about the URLs and IP ranges that AuthPoint services use, go to <a href="https://www.watchguard.com/help/docs/help-center/en-US/Content/en-US/WG-Cloud/wg-cloud_urls.html">WatchGuard Cloud URLs and Network Access Requirements</a>.</p>
                                        <p class="Note">To undo the changes made to your domain after you complete the steps in this procedure, go to the <a href="#Rollback">Rollback Instructions</a> section at the end of this integration guide.</p>
                                        <p class="Note">If you use Microsoft Office desktop applications (such as Outlook, Teams, and Word) on any device that runs Windows 10, make sure your operating system is updated to version 20H2 or higher. AuthPoint MFA does not support MFA for web applications on Windows 8.1.</p>
                                        <h2 id="Contents" data-magellan-target="Contents">Contents</h2>
                                        <ul data-magellan="" data-animation-duration="250" data-active-class="selected" data-scroll-container=".body-container" data-scroll-container-on="only screen and (min-width: 980px)" class="nocontent menu _Skins_Help_Center_Menu_Slide mc-component">
                                            <li class="tree-node"><a href="#Microsoft365IntegrationwithAuthPoint">Microsoft 365 Integration with AuthPoint</a>
                                            </li>
                                            <li>
                                                <ul>
                                                    <li class="tree-node"><a href="#Contents">Contents</a>
                                                    </li>
                                                    <li>
                                                        <ul>
                                                            <li class="tree-node"><a href="#Microsoft365AuthenticationDataFlowwithAuthPoint">Microsoft 365 Authentication Data Flow with AuthPoint</a>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                    <li class="tree-node"><a href="#BeforeYouBegin">Before You Begin</a>
                                                    </li>
                                                    <li class="tree-node"><a href="#ConfigureAuthPoint">Configure AuthPoint</a>
                                                    </li>
                                                    <li>
                                                        <ul>
                                                            <li class="tree-node"><a href="#AddaSAMLResourceinAuthPoint">Add a SAML Resource in AuthPoint</a>
                                                            </li>
                                                            <li class="tree-node"><a href="#AddaGroupinAuthPoint">Add a Group in AuthPoint</a>
                                                            </li>
                                                            <li class="tree-node"><a href="#AddanAuthenticationPolicytoAuthPoint">Add an Authentication Policy to AuthPoint</a>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                    <li class="tree-node"><a href="#ConfigureMicrosoft365">Configure Microsoft 365</a>
                                                    </li>
                                                    <li class="tree-node"><a href="#SynchronizeUsersfromYourActiveDirectory">Synchronize Users from Your Active Directory</a>
                                                    </li>
                                                    <li class="tree-node"><a href="#TesttheIntegration">Test the Integration</a>
                                                    </li>
                                                    <li class="tree-node"><a href="#RollbackInstructions">Rollback Instructions</a>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                        <h3 id="Microsoft365AuthenticationDataFlowwithAuthPoint" data-magellan-target="Microsoft365AuthenticationDataFlowwithAuthPoint">Microsoft 365 Authentication Data Flow with AuthPoint</h3>
                                        <p>AuthPoint communicates with various cloud-based services and service providers with the SAML protocol. This diagram shows the data flow of an MFA transaction for Microsoft 365.</p>
                                        <p class="img">
                                            <img src="_images/Office365/Microsoft-365-AuthPoint-Topology.png" style="max-height: auto;max-width: 100%;width: 650px;height: auto;" alt="The screenshot of Microsoft 365 Topology" />
                                        </p>
                                        <h2 id="BeforeYouBegin" data-magellan-target="BeforeYouBegin">Before You Begin</h2>
                                        <p>Before you begin these procedures, make sure that:</p>
                                        <ul style="list-style-type: square;">
                                            <li>You install and configure the AuthPoint Gateway (see <a href="https://www.watchguard.com/help/docs/help-center/en-US/Content/en-US/authpoint/gateways.html">About Gateways</a>).</li>
                                            <li>End-users can log in to Microsoft 365.</li>
                                            <li>A token is assigned to a user in AuthPoint (to test MFA).</li>
                                            <li>You have an <a href="#" class="MCTextPopup popup popupHead popupHeaddefinition">AuthPoint identity provider (IdP) certificate<span class="MCTextPopupBody MCTextPopupBody_Closed needs-pie popupBody" aria-hidden="true"><span class="MCTextPopupArrow"> </span>An AuthPoint IdP certificate is required for SAML authentication.</span></a> (go to <a href="../../en-US/authpoint/certificates.html" class="MCXref xref">Certificate Management</a>).</li>
                                            <li>To use Microsoft Graph PowerShell, you must have PowerShell v5.1 or higher.</li>
                                        </ul>
                                        <h2 id="ConfigureAuthPoint" data-magellan-target="ConfigureAuthPoint">Configure AuthPoint</h2>
                                        <p style="page-break-after: always;page-break-before: avoid;">Before AuthPoint can receive  authentication requests from Microsoft 365, you must specify the Microsoft 365 client as a resource in AuthPoint. You must also create an <a href="#" class="MCTextPopup popup popupHead popupHeaddefinition">authentication policy<span class="MCTextPopupBody MCTextPopupBody_Closed needs-pie popupBody" aria-hidden="true"><span class="MCTextPopupArrow"> </span>Authentication policies specify which resources users can authenticate to and which authentication methods they can use (Push, QR code, and OTP).</span></a> for the Microsoft 365 resource to determine which users can authenticate and log in to Microsoft 365 and which authentication methods they can use (Push, QR code, and OTP).</p>
                                        <p>To configure AuthPoint:</p>
                                        <ol>
                                            <li value="1"><a href="#Add" title="Add a SAML Resource in AuthPoint" class="MCXref xref">Add a SAML Resource in AuthPoint</a>.</li>
                                            <li value="2"><a href="#Add2" title="Add a Group in AuthPoint" class="MCXref xref">Add a Group in AuthPoint</a>.</li>
                                            <li value="3"><a href="#Add3" title="Add an Authentication Policy to AuthPoint" class="MCXref xref">Add an Authentication Policy to AuthPoint</a>.<br /></li>
                                        </ol>
                                        <h3 id="AddaSAMLResourceinAuthPoint" data-magellan-target="AddaSAMLResourceinAuthPoint"><a name="Add"></a>Add a SAML Resource in AuthPoint</h3>
                                        <p class="Note">If you have multiple Microsoft 365 domains, you only need to configure a SAML resource for your primary domain.</p>
                                        <p>From the AuthPoint management UI:</p>
                                        <ol>
                                            <li value="1">From the navigation menu, select <b>Resources</b>.
 Click <b>Add Resource</b>.<br /><span class="NumContinued">The Add Resource page opens.</span><![CDATA[        
        ]]></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_resources.png" style="height: auto;max-width: 100%;max-height: auto;width: 750px;" class="hasBorder" />
                                        </p>
                                        <ol data-mc-continue="true">
                                            <li value="2">From the <b>Type</b> drop-down list, select <b>SAML</b>.<br /><span class="NumContinued">Additional fields appear.</span></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_resources_add.png" />
                                        </p>
                                        <ol start="3">
                                            <li value="3">On the <b>SAML</b> page, in the <b>Name</b> text box, type a name for this resource.</li>
                                            <li value="4">From the <b>Application Type</b> drop-down list, select <b>Office 365</b>.</li>
                                            <li value="5">In the <b>Service Provider Entity ID</b> text box, type <span class="Input">urn:federation:MicrosoftOnline</span>.</li>
                                            <li value="6">In the <b>Assertion Consumer Service</b> text box, type <span class="Input">https://login.microsoftonline.com/login.srf</span>.</li>
                                            <li value="7">From the <b>Signature Method</b> drop-down list, select <b>SHA-256</b>.</li>
                                            <li value="8"><a name="In"></a>In the <b>Federated Domain</b> text box, type your federated domain.</li>
                                            <li value="9"><a name="AuthPointCert"></a>From the <b>AuthPoint Certificate</b> drop-down list, select the AuthPoint certificate to associate with your resource. We recommend that you select the certificate with the latest expiration date.</li>
                                            <li value="10">Click <b>Save</b>.</li>
                                        </ol>
                                        <h3 id="AddaGroupinAuthPoint" data-magellan-target="AddaGroupinAuthPoint"><a name="Add2"></a>Add a Group in AuthPoint</h3>
                                        <p style="page-break-after: avoid;page-break-before: avoid;">You must have at least one user group in AuthPoint to configure MFA. If you already have a group, you do not have to add another group.</p>
                                        <p>To add a WatchGuard Cloud-hosted group to the WatchGuard Cloud Directory:</p>
                                        <ol>
                                            <li value="1">Go to <b>Configure &gt;&#160;Directories and Domain Services</b>.</li>
                                            <li value="2">Click the WatchGuard Cloud Directory domain name. If you have not yet added the WatchGuard Cloud Directory, click <b>Add Authentication Domain</b> and select the WatchGuard Cloud Directory.<br /><span class="NumContinued">The New Group page appears.</span></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/auth_domains.png" alt="Screenshot that shows the Directories and Domain Services page." />
                                        </p>
                                        <ol data-mc-continue="true">
                                            <li value="3">In the <b>Groups</b> tab, click <b>Add Group</b>.</li>
                                            <li value="4">In the <b>Group Name</b> text box, type a descriptive name for the group.</li>
                                            <li value="5">(Optional) In the <b>Description</b> text box, type a description of the group.</li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/auth_domain_add_group.png" alt="Screen shot of the Add Group page." />
                                        </p>
                                        <ol data-mc-continue="true">
                                            <li value="6">Click <b>Save</b>.<br /><span class="NumContinued">Your group is added to the WatchGuard Cloud Directory and to AuthPoint.</span></li>
                                        </ol>
                                        <h3 id="AddanAuthenticationPolicytoAuthPoint" data-magellan-target="AddanAuthenticationPolicytoAuthPoint"><a name="Add3"></a>Add an Authentication Policy to AuthPoint</h3>
                                        <p>Authentication policies specify which resources users can authenticate to and which authentication methods they can use (Push, QR code, and OTP).</p>
                                        <p>You must have at least one authentication policy in AuthPoint that includes the Microsoft 365 resource. If you already have authentication policies, you do not have to create a new authentication policy. You can add this resource to your existing authentication policies.</p>
                                        <p class="Note">Users that do not have an authentication policy for a specific resource cannot authenticate to log in to that resource.</p>
                                        <p>To configure an authentication policy:</p>
                                        <ol style="page-break-after: avoid;">
                                            <li value="1">From the navigation menu, select <b>Authentication Policies</b>.</li>
                                            <li value="2">Click <b>Add Policy</b>.
</li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_policies_empty.png" style="max-height: auto;max-width: 100%;height: auto;width: 850px;" alt="Screenshot of the Add Policy button on the Authentication Policies page." />
                                        </p>
                                        <ol style="page-break-after: avoid;page-break-inside: avoid;" data-mc-continue="true">
                                            <li value="3">Type a name for this policy.</li>
                                            <li value="4">From the <b>Select the Authentication Options</b> drop-down list, select <b>Authentication Options</b> and select which authentication options users can choose from when they authenticate.<p class="Note">For SAML resources, if you select more than one authentication option, users must select one of the available options when they authenticate. For example, if you select OTP and Push, users can choose to type their OTP or approve a push to authenticate. You cannot require that they do both.</p></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_policies_add_auth-options.png" style="height: auto;max-width: 100%;max-height: auto;width: 600px;" />
                                        </p>
                                        <ol style="page-break-after: avoid;page-break-inside: avoid;" data-mc-continue="true">
                                            <li value="5">Select which groups this policy applies to. You can select more than one group. To configure this policy to apply to all groups, select <b>All Groups</b>.</li>
                                            <li value="6">Select the resource that you created in the previous section. If you want this policy to apply to additional resources, select each resource this policy applies to. To configure this policy to apply to all resources, select <b>All Resources</b>.</li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_policy_groups-resources.png" style="max-width: 100%;max-height: auto;height: auto;width: 600px;" alt="Screenshot of the Add Policy page with the groups and resources selected" />
                                        </p>
                                        <ol style="page-break-after: avoid;page-break-inside: avoid;" data-mc-continue="true">
                                            <li value="7">
                                                <p>(Optional) If you have configured policy objects such as a Network Location, select which policy objects apply to this policy. When you add a policy object to a policy, the policy only applies to user authentications that are the same as the conditions of the policy objects. For example, if you add a Network Location to a policy, the policy only applies to user authentications that come from that Network Location. Users who only have a policy that includes a Network Location do not get access to the resource when they authenticate outside of that Network Location (because they do not have a policy that applies, not because authentication is denied).</p>
                                                <p class="Note">If you configure policy objects, we recommend that you create a second policy for the same groups and resources without the policy objects. The policy with the policy objects should have a higher priority.</p>
                                            </li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_policies_select_policy-objects.png" style="max-height: auto;max-width: 100%;height: auto;width: 600px;" alt="Screenshot of the Policy Objects drop-down list." />
                                        </p>
                                        <ol style="page-break-after: avoid;page-break-inside: avoid;" data-mc-continue="true">
                                            <li value="8">Click <b>Save</b>.
<br /><span class="NumContinued">Your policy is created and added to the end of the policy list.
</span><p class="Note">When you create a new policy, we recommend that you review the order of your policies. AuthPoint always adds new policies to the end of the policy list.</p></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_policies_save-policy.png" style="max-height: auto;max-width: 100%;height: auto;width: 600px;" alt="Screenshot of the Save button on the Add Policy page." />
                                        </p>
                                        <h2 id="ConfigureMicrosoft365" data-magellan-target="ConfigureMicrosoft365"><a name="Configur"></a>Configure Microsoft 365</h2>
                                        <p>Before you configure Microsoft 365, you must download the metadata file from the Certificate Management page in the AuthPoint management UI. For information about how to download the metadata file, go to <a href="https://www.watchguard.com/help/docs/help-center/en-US/Content/en-US/authpoint/certificates.html" target="_blank">Certificate Management</a>.</p>
                                        <p>To configure Microsoft 365:</p>
                                        <ol style="page-break-after: avoid;">
                                            <li value="1">Log in to WatchGuard Cloud.</li>
                                            <li value="2">From the navigation menu, select <b>Configure &gt; AuthPoint</b>. If you have a Service Provider account, you must select an account from Account Manager.</li>
                                            <li value="3">Select <b>Resources</b>.<br /><span class="NumContinued">The Resources page opens.</span></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_resources.png" style="height: auto;width: 750px;max-width: 100%;max-height: auto;" class="hasBorder" />
                                        </p>
                                        <ol style="page-break-after: avoid;" start="4">
                                            <li value="4">Click <b>Certificate</b>.<br /><span class="NumContinued">The Certificate page opens.</span></li>
                                        </ol>
                                        <p class="img_indent_1">
                                            <img src="../../__Templates/images/apt_cert-mgmt_cert-menu.PNG" style="height: auto;width: 750px;max-width: 100%;max-height: auto;" class="hasBorder" />
                                        </p>
                                        <ol start="5">
                                            <li value="5">Next to the AuthPoint certificate you associated with your resource in <a href="#AuthPointCert">the previous section</a>, click <img src="_images/menu_icon.png" style="height: 13px;width: auto;" />, then select <b>Download Metadata</b>.<br />The AuthPoint metadata provides your resource, in this case Microsoft 365, with the necessary information to identify AuthPoint as a trusted identity provider. If you do not have a certificate, or if all of your certificates have expired, click <b>Add Certificate</b> and use the new certificate.</li>
                                            <li value="6">To set up your environment for identity federation, follow the steps in <a href="https://learn.microsoft.com/en-us/microsoft-365/enterprise/connect-to-microsoft-365-powershell?view=o365-worldwide#connect-with-microsoft-graph-powershell">Connect with Microsoft Graph PowerShell</a>. You must sync your on-premise AD users to Microsoft Entra ID (formerly Azure AD).</li>
                                            <li value="7">Launch the Microsoft Graph PowerShell you configured in step 6, then type <span class="Input">Connect-MgGraph -Scopes "Domain.ReadWrite.All","Directory.AccessAsUser.All"</span> to log in with your Microsoft 365 global administrator credentials.<p class="Note">You cannot federate the default domain and initial domain in Microsoft 365. You must register another domain with Microsoft 365 or connect an existing domain to the Microsoft 365 service. For more information, go to the Microsoft documentation. You can then use the configured domain when you configure AuthPoint.</p></li>
                                            <li value="8">To verify the status of domains, type <span class="Input">Get-MgDomain -DomainId yourmicrosoft365domain</span>. Your domain  must be verified and have a status of Managed. If your domain is already federated, before you continue, change the status of your domain from Federated to Managed. To change the status, follow the steps in the <a href="#Rollback" class="MCXref xref">Rollback Instructions</a> section.<p class="Note">If your domain is federated, to return your federation settings, we recommend that you run this command:<br /><span class="Input">$saml = Get-MgDomainFederationConfiguration -DomainId &lt;domain_name&gt;</span>.<br />This information is necessary if you want to undo the changes you made to your domain.</p><p class="Note">Before you federate your Microsoft 365 domain, make sure that you have enabled modern authentication for Outlook in Exchange Online. For more information, go to this <a href="       https://techsearch.watchguard.com/KB?type=Article&amp;SFDCID=kA16S000000FwwESAS&amp;lang=en_US" target="_blank">Knowledge Base - Article</a>.</p></li>
                                            <li value="9">Set these federation parameters as PowerShell variables:<ul data-mc-continue="true"><li><span class="Input">$Domain = "<span class="UserVariable">your_Microsoft_365_domain</span>"</span> (This parameter matches the  federated domain in <a href="#In">the previous section</a>)</li><li><span class="Input">$LogOnUrl = "https://sp.authpoint.<span class="UserVariable">your WatchGuard Cloud region</span>.cloud.watchguard.com/saml/<span class="UserVariable">your account ID</span>/sso/spinit"</span> (This URL appears in your AuthPoint metadata file, labeled as <b>SingleSignOnService</b>)</li><li><span class="Input">$LogOffUrl = "https://sp.authpoint.<span class="UserVariable">your WatchGuard Cloud region</span>.cloud.watchguard.com/saml/<span class="UserVariable">your account ID</span>/slo/spinit"</span> (This parameter appears in your AuthPoint metadata file, labeled as <b>SingleLogoutService</b>)</li><li><span class="Input">$MyUri = "https://sp.authpoint.cloud.watchguard.com/<span class="UserVariable">your account ID</span></span>" (This URL appears in your AuthPoint metadata file, labeled as <b>entityID</b>)</li><li><span class="Input">$Protocol = "saml"</span></li><li><span class="Input">$MySigningCert = "<span class="UserVariable">the X.509 certificate in string format</span>"</span> (This value appears in your AuthPoint metadata file, labeled as <b>X509Certificate</b>, with no spaces)<p class="Note">For more information about how to format the X.509 value as a string, go to <a href="https://www.samltool.com/format_x509cert.php" target="_blank">https://www.samltool.com/format_x509cert.php</a>.</p><p class="Note">To federate more than one domain with AuthPoint, for each additional domain, you must repeat each of the above parameters and append <span class="Input">?your_Microsoft_365_domain_name</span> at the end of the <span class="Input">$MyUri</span> parameter. Do not append anything to the first domain that you federate, or the federation will not work.</p></li></ul></li>
                                            <li value="10">To convert the Microsoft 365 domain to Federated, run this PowerShell command:<p><span class="Input">New-MgDomainFederationConfiguration -DomainId $Domain -PassiveSignInUri $LogOnUrl -SignOutUri $LogOffUrl -IssuerUri $MyUri -PreferredAuthenticationProtocol $Protocol -SigningCertificate $MySigningCert -FederatedIdpMfaBehavior "enforceMfaByFederatedIdp" | Format-List</span>.</p></li>
                                            <li value="11">To verify that your domain is Federated, run this PowerShell command:<p><span class="Input">Get-MgDomain -DomainId yourmicrosoft365domain</span></p></li>
                                        </ol>
                                        <p>To configure Skype for Business:</p>
                                        <ol data-mc-continue="false">
                                            <li value="1">	Install the <a href="https://docs.microsoft.com/en-us/microsoftteams/teams-powershell-install">Microsoft Teams PowerShell module</a>.</li>
                                            <li value="2">Run PowerShell as an administrator.</li>
                                            <li value="3">Run these commands:<ul data-mc-continue="true"><li><span class="Input">Import-Module MicrosoftTeams</span></li><li><span class="Input">$userCredential = Get-Credential</span></li></ul><p class="Note">You must use this command with a Microsoft 365 administrator account on a domain that is not federated — usually the default Microsoft 365 domain (<span class="Input">&lt;domain&gt;.onmicrosoft.com</span>).</p><ul data-mc-continue="true"><li><span class="Input">Connect-MicrosoftTeams -Credential $userCredential</span></li></ul></li>
                                        </ol>
                                        <p>The process to configure Skype for Business might take two hours to complete.</p>
                                        <h2 id="SynchronizeUsersfromYourActiveDirectory" data-magellan-target="SynchronizeUsersfromYourActiveDirectory">Synchronize Users from Your Active Directory</h2>
                                        <p>You must sync your on-premise AD users (that you synced to Microsoft Entra ID earlier) to AuthPoint so that the users have the same attributes and both Microsoft 365 and AuthPoint can recognize them.</p>
                                        <p>To sync users from Active Directory  to AuthPoint, you must add an <i>external identity</i> in AuthPoint. External identities connect to user databases to get user account information and validate passwords. For more information, go to <a href="https://www.watchguard.com/help/docs/help-center/en-US/Content/en-US/authpoint/external-identity_ldap.html">Sync Users from Active Directory or LDAP</a>.</p>
                                        <p class="Note">You must install and configure a Gateway before you configure ADFS or sync users from your LDAP database. For more information, go to <a href="https://www.watchguard.com/help/docs/help-center/en-US/Content/en-US/authpoint/gateways.html">About Gateways</a>.</p>
                                        <h2 id="TesttheIntegration" data-magellan-target="TesttheIntegration">Test the Integration</h2>
                                        <p style="page-break-after: avoid;page-break-before: avoid;">To test the integration of AuthPoint and Microsoft 365, you can authenticate with a mobile token on your mobile device. You can choose any method (one-time password, QR code, or push).</p>
                                        <p style="page-break-after: avoid;page-break-before: avoid;">In this example, we test the integration with the push authentication method (users receive a push notification in the mobile app that they must approve to authenticate).</p>
                                        <ol>
                                            <li value="1">In a web browser, connect to Microsoft 365.</li>
                                            <li value="2">In the <b>Sign In</b> text box, type your email address.</li>
                                            <li value="3">Click <b>Next</b>.</li>
                                            <li value="4">Type your email address or AuthPoint user name, then click <b>Next</b>.</li>
                                            <li value="5">If required, in the <b>Password</b> text box, type your password.</li>
                                            <li value="6">For the authentication method, select <b>Send Push</b>.</li>
                                            <li value="7">Approve the authentication request  you receive on your mobile device.<br /><span class="NumContinued">You are logged in to Microsoft 365.</span></li>
                                        </ol>
                                        <h2 id="RollbackInstructions" data-magellan-target="RollbackInstructions"><a name="Rollback"></a>Rollback Instructions</h2>
                                        <p>This section describes the steps to undo the changes you made to your domain. If you want to do this, you change the status of your domain from Federated to Managed and reconfigure the settings from a previously federated domain.</p>
                                        <p class="Note">Microsoft 365 does not support multiple federations on a single domain. Before you begin, confirm the status of your domain in Microsoft 365.</p>
                                        <p>To change the status of your domain from Federated to Managed:</p>
                                        <ol>
                                            <li value="1">Run PowerShell, then type <span class="Input">Connect-MgGraph -Scopes "Domain.ReadWrite.All","Directory.AccessAsUser.All"</span>.</li>
                                            <li value="2">Log in with your Microsoft 365 global administrator credentials.<br /><span class="NumContinued">Wait for the connection  to establish. This might take several minutes.</span></li>
                                            <li value="3">To verify your domain status, type <span class="Input">Get-MgDomain -DomainId yourmicrosoft365domain</span>.</li>
                                            <li value="4">To get your InternalDomainFederationId, type <span class="Input">Get-MgDomainFederationConfiguration -DomainId yourmicrosoft365domain</span>.<br /><span class="NumContinued">You get the InternalDomainFederationId from the value of the yourInternalDomainFederationId parameter in the output. If you have federated your domain with the old MSOnline module, you can also get yourInternalDomainFederationId with this command.</span></li>
                                            <li value="5">To modify the status, type <span class="Input">Remove-MgDomainFederationConfiguration -DomainId yourmicrosoft365domain -InternalDomainFederationId yourInternalDomainFederationId</span>.<br /></li>
                                            <li value="6">To verify the status of your domain is Managed, type <span class="Input">Get-MgDomain -DomainId yourmicrosoft365domain</span>.</li>
                                        </ol>
                                        <p>To restore the settings for a federated domain:</p>
                                        <p class="Note"> To restore the settings for your previously federated domain, you must have run the command <span class="Input">$saml = Get-MgDomainFederationConfiguration -DomainId &lt;domain_name&gt;</span> in the <a href="#Configur">Configure Microsoft 365</a> section.</p>
                                        <ol>
                                            <li value="1">To log in with your Microsoft 365 global administrator credentials, run PowerShell, then type <span class="Input">Connect-MgGraph -Scopes "Domain.ReadWrite.All","Directory.AccessAsUser.All"</span>.</li>
                                            <li value="2">To verify your domain status, type <span class="Input">Get-MgDomain -DomainId yourmicrosoft365domain</span>.</li>
                                            <li value="3">Type <span class="Input">New-MgDomainFederationConfiguration -DomainId &lt;domain_name&gt; -FederatedIdpMfaBehavior $saml.FederatedIdpMfaBehavior -IssuerUri $saml.IssuerUri -PassiveSignInUri $saml.PassiveSignInUri -PreferredAuthenticationProtocol $saml.PreferredAuthenticationProtocol -SignOutUri $saml.SignOutUri -SigningCertificate $saml.SigningCertificate</span>.</li>
                                        </ol>
                                    </div>
                                    <p class="FooterTop"><a href="../../en-US/Fireware/support/doc_feedback.html">Give Us Feedback</a>&#160;&#160;●&#160;&#160;
            <a href="../../en-US/Fireware/support/getsupport.html">Get Support</a>&#160;&#160;●&#160;&#160;
            <a href="https://www.watchguard.com/wgrd-help/documentation/overview" target="_blank">All Product Documentation</a>&#160;&#160;●&#160;&#160;
            <a href="https://techsearch.watchguard.com/" target="_blank">Technical Search</a></p>
                                    <p class="Footer">© <span class="mc-variable Global.CurrentYear variable">2024</span> WatchGuard Technologies, Inc. All rights reserved. WatchGuard and the WatchGuard logo are registered trademarks or trademarks of WatchGuard Technologies in the United States and other countries. Various other trademarks are held by their respective owners.</p>
                                    <p class="Footer">&#160;</p>
                                    <div id="expand-collapse" title="Expand/collapse navigation" class="collapse">
                                    </div>
                                    <script src="../../Resources/MasterPages/scripts/expand-collapse.js">
                                    </script>
                                    <script src="../../Resources/MasterPages/scripts/cover-hide.js">
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>